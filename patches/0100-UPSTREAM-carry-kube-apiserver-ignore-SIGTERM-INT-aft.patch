From 1a3ba48bdd58f07dc1c882a95fc3d79f9c1b7b95 Mon Sep 17 00:00:00 2001
From: Fabio Bertinatto <fbertina@redhat.com>
Date: Wed, 27 Nov 2024 17:06:21 -0300
Subject: [PATCH] UPSTREAM: <carry>: kube-apiserver: ignore SIGTERM/INT after
 the first one

---
 cmd/kube-apiserver/app/server.go | 5 ++---
 1 file changed, 2 insertions(+), 3 deletions(-)

diff --git a/cmd/kube-apiserver/app/server.go b/cmd/kube-apiserver/app/server.go
index 9badbfb29ee..ae2259c26c3 100644
--- a/cmd/kube-apiserver/app/server.go
+++ b/cmd/kube-apiserver/app/server.go
@@ -71,8 +71,7 @@ func NewAPIServerCommand() *cobra.Command {
 	_, featureGate := featuregate.DefaultComponentGlobalsRegistry.ComponentGlobalsOrRegister(
 		featuregate.DefaultKubeComponent, utilversion.DefaultBuildEffectiveVersion(), utilfeature.DefaultMutableFeatureGate)
 	s := options.NewServerRunOptions()
-	ctx := genericapiserver.SetupSignalContext()
-
+	ctx := genericapiserver.SetupSignalContextNotExiting()
 	cmd := &cobra.Command{
 		Use: "kube-apiserver",
 		Long: `The Kubernetes API server validates and configures data
@@ -158,7 +157,7 @@ cluster's shared state through which all other components interact.`,
 		},
 	}
 
-	cmd.SetContext(genericapiserver.SetupSignalContextNotExiting())
+	cmd.SetContext(ctx)
 
 	fs := cmd.Flags()
 	namedFlagSets := s.Flags()
-- 
2.47.0

